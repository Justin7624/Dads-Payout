<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payout Calculator</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  padding: 20px;
}
.card {
  max-width: 720px;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,.1);
}
label {
  display: block;
  margin-top: 12px;
  font-weight: bold;
}
select, input, button {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
}
.row {
  border: 1px solid #ddd;
  padding: 12px;
  border-radius: 6px;
  margin-top: 10px;
}
.result {
  margin-top: 18px;
  background: #fafafa;
  padding: 12px;
  border-radius: 6px;
}
button {
  cursor: pointer;
}
</style>
</head>
<body>

<div class="card">
  <h2>Payout Calculator</h2>

  <div id="items"></div>

  <button onclick="addItem()">âž• Add Peptide</button>

  <label>Shipping</label>
  <select id="shipping">
    <option value="10">5 Day ($10)</option>
    <option value="15">3 Day ($15)</option>
  </select>

  <div class="result" id="output"></div>
</div>

<script>
const DAD_PERCENT = 0.4545;
const PRICE_MULTIPLIER = 4.29;

/* ---------- Rounding ---------- */
function roundSmart(n){
  const step = n <= 100 ? 5 : 10;
  const lower = Math.floor(n / step) * step;
  if (n - lower <= 1.5) return n;
  return Math.ceil(n / step) * step;
}
const fix = n => Math.round(n * 100) / 100;

/* ---------- PRODUCT DATA ---------- */
const PRODUCTS = {
  "Retatrutide": {5:{raw:14},10:{raw:18},15:{raw:22},20:{raw:25},30:{raw:35}},
  "Tirzepatide": {5:{raw:15},10:{raw:18},15:{raw:22},20:{raw:26},30:{raw:30}},
  "Semaglutide": {5:{raw:12},10:{raw:16},15:{raw:20},20:{raw:24}},
  "BPC-157": {10:{raw:10},20:{raw:18}},
  "TB500": {5:{raw:12},10:{raw:22}},
  "GHK-CU": {50:{raw:18},100:{raw:35}}
};

/* ---------- Calculate sale prices ---------- */
for (const p in PRODUCTS) {
  for (const mg in PRODUCTS[p]) {
    PRODUCTS[p][mg].sale = roundSmart(PRODUCTS[p][mg].raw * PRICE_MULTIPLIER);
  }
}

const itemsDiv = document.getElementById("items");

function addItem() {
  const div = document.createElement("div");
  div.className = "row";

  div.innerHTML = `
    <label>Product</label>
    <select class="product"></select>

    <label>MG</label>
    <select class="mg"></select>

    <label>Quantity</label>
    <input type="number" class="qty" value="1" min="1">

    <button onclick="this.parentElement.remove(); calculate()">Remove</button>
  `;

  const productSelect = div.querySelector(".product");
  const mgSelect = div.querySelector(".mg");

  Object.keys(PRODUCTS).forEach(p => {
    const opt = document.createElement("option");
    opt.value = p;
    opt.textContent = p;
    productSelect.appendChild(opt);
  });

  function loadMGs() {
    mgSelect.innerHTML = "";
    Object.keys(PRODUCTS[productSelect.value]).forEach(mg => {
      const opt = document.createElement("option");
      opt.value = mg;
      opt.textContent = `${mg} mg`;
      mgSelect.appendChild(opt);
    });
    calculate();
  }

  productSelect.addEventListener("change", loadMGs);
  mgSelect.addEventListener("change", calculate);
  div.querySelector(".qty").addEventListener("input", calculate);

  loadMGs();
  itemsDiv.appendChild(div);
}

function calculate() {
  const rows = document.querySelectorAll(".row");
  let subtotal = 0;
  let dadCost = 0;

  rows.forEach(r => {
    const p = r.querySelector(".product").value;
    const mg = r.querySelector(".mg").value;
    const qty = Number(r.querySelector(".qty").value);

    subtotal += PRODUCTS[p][mg].sale * qty;
    dadCost += PRODUCTS[p][mg].raw * qty;
  });

  const shipping = Number(document.getElementById("shipping").value);

  const dadBase = roundSmart(subtotal * DAD_PERCENT);
  const dadPayout = fix(dadBase + shipping);
  const dadTakeHome = fix(dadPayout - dadCost);
  const yourNet = fix(subtotal + shipping - dadPayout);

  document.getElementById("output").innerHTML = `
    <strong>Order Total:</strong> $${fix(subtotal + shipping).toFixed(2)}<br>
    <strong>Dad Payout:</strong> $${dadPayout.toFixed(2)}<br>
    <strong>Dad Cost:</strong> $${dadCost.toFixed(2)}<br>
    <strong>Dad Take-Home:</strong> $${dadTakeHome.toFixed(2)}<br>
    <strong>Your Net:</strong> $${yourNet.toFixed(2)}
  `;
}

document.getElementById("shipping").addEventListener("change", calculate);

/* ---------- Start with one item ---------- */
addItem();
</script>

</body>
</html>
